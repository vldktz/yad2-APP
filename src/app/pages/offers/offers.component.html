<div id="actions-container">
    <button mat-raised-button color="primary" class="m-1" matTooltip="Logout" (click)="logout()">
        <mat-icon>exit_to_app</mat-icon>
    </button>
    <button mat-raised-button color="primary" class="m-1" matTooltip="Edit User" (click)="editUser()">
        <mat-icon>person</mat-icon>
    </button>
    <button mat-raised-button color="primary" class="m-1" matTooltip="New Offer" (click)="newOffer()">
        <mat-icon>add</mat-icon>
    </button>
</div>

<mat-card class="col-md-8 col-sm-10 align-self-start align-self-md-auto mt-5 mt-md-0">
    <div class="col-12">
        <mat-card-header class="row">

            <form [formGroup]="searchForm" (submit)="getOffers()" class="row">
                <div class="row align-items-center">
                    <mat-form-field class="col-md-4 col-6">
                        <mat-label>Offer Type</mat-label>
                        <mat-select [disabled]="! offerTypes" placeholder="type of the offer" id="offerType"
                                    formControlName="offerTypeID">
                            <mat-option [value]="null">All</mat-option>
                            <mat-option *ngFor="let type of offerTypes" [value]="type.id">{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="col-md-4 col-6">
                        <button mat-raised-button color="primary" [disabled]="searchForm.invalid">Search</button>
                    </div>
                    <div class="col-4 d-none d-md-flex justify-content-end">
                        <button mat-raised-button type="button" color="primary"
                                [color]="displayState == 'GRID'? 'primary' : 'warn'"
                                class="m-1" (click)="displayState = 'GRID'"
                                matTooltip="show as grid">
                            <mat-icon>grid_on</mat-icon>
                        </button>
                        <button mat-raised-button type="button" [color]="displayState == 'TABLE'? 'primary' : 'warn'"
                                class="m-1" (click)="displayState = 'TABLE'"
                                matTooltip="show as table">
                            <mat-icon>table_chart</mat-icon>
                        </button>
                    </div>
                </div>
            </form>
        </mat-card-header>
    </div>
    <mat-card-content>
        <div id="offers-table-container">
            <table mat-table [dataSource]="offers" class="mat-elevation-z8 col-12"
                   *ngIf="offers && displayState=='TABLE'">
                <ng-container matColumnDef="Title">
                    <th mat-header-cell *matHeaderCellDef>Title</th>
                    <td mat-cell *matCellDef="let offer"> {{offer.title}} </td>
                </ng-container>
                <ng-container matColumnDef="Description">
                    <th mat-header-cell *matHeaderCellDef>Description</th>
                    <td mat-cell *matCellDef="let offer"
                        [matTooltip]="offer.description"> {{offer.description | truncate :[20, '...']}} </td>
                </ng-container>
                <ng-container matColumnDef="OfferTypeName">
                    <th mat-header-cell *matHeaderCellDef>Type</th>
                    <td mat-cell *matCellDef="let offer"> {{offer.OfferType.name}} </td>
                </ng-container>
                <ng-container matColumnDef="UserName">
                    <th mat-header-cell *matHeaderCellDef>Owner</th>
                    <td mat-cell *matCellDef="let offer"> {{offer.User.fullName}} </td>
                </ng-container>
                <ng-container matColumnDef="PhoneNumber">
                    <th mat-header-cell *matHeaderCellDef>Phone Number</th>
                    <td mat-cell *matCellDef="let offer"><a
                        href="tel:{{offer.phoneNumber}}"> {{offer.phoneNumber}} </a>
                    </td>
                </ng-container>
                <ng-container matColumnDef="Email">
                    <th mat-header-cell *matHeaderCellDef>Email</th>
                    <td mat-cell *matCellDef="let offer"><a href="mailto:{{offer.email}}"> {{offer.email}} </a>
                    </td>
                </ng-container>


                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
        <div class="row pb-2" id="offers-grid-container" *ngIf="offers && displayState == 'GRID'">
            <div *ngFor="let offer of offers" class="col-md-4 col-sm-6 col-12 d-flex mt-4 ">
                <mat-card class="offer-card">
                    <mat-card-header>
                        <div mat-card-avatar>
                            <button mat-mini-fab disabled>
                                <mat-icon>person</mat-icon>
                            </button>
                        </div>
                        <mat-card-title>{{offer.title}}</mat-card-title>
                        <mat-card-subtitle>{{offer.User.fullName}}</mat-card-subtitle>
                    </mat-card-header>
                    <mat-card-content>
                        <h4>Type: {{offer.OfferType.name}}</h4>
                        <p>{{offer.description}}</p>
                        <h5>Email: {{offer.email}}</h5>
                        <h5>Phone number: {{offer.phoneNumber}}</h5>
                    </mat-card-content>
                    <mat-card-actions>
                            <a mat-raised-button class="col-2" href="tel:{{offer.phoneNumber}}">
                                <mat-icon>phone</mat-icon>
                            </a>
                            <a href="mailto:{{offer.email}}" class="col-2" mat-raised-button>
                                <mat-icon>email</mat-icon>
                            </a>
                    </mat-card-actions>
                </mat-card>
            </div>
        </div>
    </mat-card-content>
</mat-card>
